import os
from bs4 import BeautifulSoup

# 1. It needs to read a file "evilcorp.html"

file_dir = os.path.dirname(__file__)
file_name = os.path.join(file_dir, '../../materials/evilcorp.html')

f = open(file_name, "r")
html_page = f.read()
f.close()

soup = BeautifulSoup(html_page, 'html.parser')

# 2. Modify page title (in <title> tags) to be "Evil Corp - Stealing your money every day"
title = soup.find('title')
title.string.replace_with('Evil Corp - Stealing your money every day')

# 3. It should parse out the name of the user from the page (including the pronoun) and 
#	inject new tag <h1> into a body of a page, saying <h1>Mr. Robot, you are hacked!</h1>, 
#	where 'Mr. Robot' is a parsed pronoun and name.
name = soup.find("span", {"class": "name"}).text
new_header = soup.new_tag("h1")
new_header.string = name + ", you are hacked!"
soup.html.body.insert(1, new_header)

# 4. It needs to inject a Trenton's script into a body of a page as well. If everything 
#	is okay, when the 'Send' button is pressed, you should see the word "hacked" 
#	appearing in an alert window.
script = soup.new_tag("script")
script.string = r"""
	hacked = function() {
		alert('hacked');
	}
	window.addEventListener('load', 
		function() { 
		var f = document.querySelector("form");
		f.setAttribute("onsubmit", "hacked()");
		},
		false
	);
"""
soup.html.body.insert(1, script)

# 5. the link at the bottom of a page should now lead to 
# 	"https://mrrobot.fandom.com/wiki/Fsociety" with an 
# 	actual name of the company on a page replaced with "Fsociety".
link = soup.find("a")
link.string = "Fsociety"
link["href"] = "https://mrrobot.fandom.com/wiki/Fsociety"

# Save
file_name = os.path.join(file_dir, '../../materials/evilcorp_hacked.html')
with open(file_name, 'w') as f:
    f.write(str(soup))